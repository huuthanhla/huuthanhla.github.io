<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Phả Hệ Dòng Họ Lã Hữu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <div class="main-container">
        
        <header>
            <div class="text-center">
                <div class="d-flex justify-content-center align-items-center gap-3 mb-2 flex-wrap">
                    <h1 class="mb-0 text-uppercase text-danger fw-bold">Phả Hệ Lã Hữu</h1>
                    <button class="btn btn-outline-success btn-sm rounded-pill fw-bold" onclick="showHistoryModal()">
                        <i class="fas fa-scroll me-1"></i> Lược sử
                    </button>
                </div>
            </div>
        </header>

        <div class="card bg-light border-0 mb-4">
            <div class="card-body p-3">
                <div class="row g-2 align-items-center">
                    <div class="col-12 col-md-auto">
                        <label class="fw-bold text-primary mb-0"><i class="fas fa-database me-1"></i> Dữ liệu:</label>
                    </div>
                    <div class="col-12 col-md">
                        <input type="file" id="jsonFile" class="form-control" accept=".json">
                    </div>
                    <div class="col-12 col-md-auto d-flex gap-2">
                        <button class="btn btn-primary flex-fill" onclick="importJsonFile()">
                            <i class="fas fa-file-import me-1"></i> Import
                        </button>
                        <button class="btn btn-success flex-fill" onclick="downloadJSON()">
                            <i class="fas fa-download me-1"></i> Backup
                        </button>
                        <button class="btn btn-danger flex-fill" onclick="resetData()">
                            <i class="fas fa-redo me-1"></i> Reset
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="input-group input-group-lg mb-4 shadow-sm">
            <input type="text" id="searchInput" class="form-control border-start-0" placeholder="Nhập tên thành viên cần tìm (Ví dụ: Lã Hữu Thu)...">
            <button class="btn btn-danger px-4 fw-bold" type="button" onclick="searchMember()">
                <i class="fas fa-search"></i>
            </button>
        </div>

        <div id="resultsArea">
            <div class="text-center text-muted py-5">
                <i class="fas fa-search fa-3x mb-3 opacity-25"></i>
                <p>Nhập tên vào ô tìm kiếm để bắt đầu tra cứu và chỉnh sửa.</p>
            </div>
        </div>
    </div>
</div>

<div class="fab-container">
    <a href="tree.html" target="_blank" class="fab-btn" title="Xem Sơ Đồ">
        <i class="fas fa-sitemap"></i>
    </a>
    <span class="fab-label">Xem Sơ Đồ</span>
</div>

<div class="modal fade" id="historyModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title fw-bold"><i class="fas fa-book-reader me-2"></i>TRÍCH ĐOẠN GIA PHẢ HỌ LÃ HỮU</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="text-start" style="padding: 16px;">
                <p class="subtitle mb-1">Địa chỉ: Thôn Yên Liêu Thượng, xã Khánh Thịnh, huyện Yên Mô, Ninh Bình</p>
                <p class="note-address mb-0" id="newAddress">Sau sát nhập: Thôn Yên Liêu Thượng, Xã Yên Mô, tỉnh Ninh Bình</p>
            </div>
            <div class="modal-body history-text">
                <p>Nguồn gốc họ Lã Hữu qua tìm hiểu văn bia, truyền khẩu và giấy tờ Gia Phả để lại thì khoảng cuối thế kỷ 16 thủy tổ họ Lã đã có mặt trên đất Yên Liêu, đến đời thứ 3 không ghi được hết. Theo gia phả để lại viễn tổ họ Lã là cụ <span class="highlight-text">Lã Hữu Giữa</span>, sinh hạ được cụ Lã Hữu Điền. Cụ Lã Hữu Điền sinh được 2 nam (Lã Hữu Lý, Lã Hữu Khu) và 2 nữ.</p>
                <p>Sinh thời cụ <span class="highlight-text">Lã Hữu Lý</span> được Triều đình nhà Lê thụ phong chức Thủ Hợp, cụ lấy bà Lã Thị Tại, con cụ Lã Hữu Kim làm Tri phủ Đồng Tiêu. Ông bà sinh hạ được 9 người con, kinh tế gia đình khá giả.</p>
                <p>Năm Mậu Tuất 1778 mất mùa, lại chiến tranh, dân tình thiếu thốn đói rét, một số người chết. Gia đình đã dành dụm cứu đói bà con trong thôn ấp, cùng lúc đó gia đình thường mua ván giúp đỡ những người chết không nơi nương tựa.</p>
                <p>Năm 1788 Vua Quang Trung tấn công ra Bắc, lúc đó một số người chịu ơn vua Lê tìm cách chống lại. Một người tên Sáu người Hà Dương, Hà Trung, Thanh Hóa có âm mưu chống lại nhà Tây Sơn và lẩn trốn ở nhà bố vợ quê ngoại làng Yên Liêu để ẩn dật. Sau này quân Tây Sơn bắt được ở sông Vân Sàng, đồng thời về làng bắt thêm 3 người nữa để tra xét.</p>
                <p>Cụ Lã Hữu Lý nguyên Thủ Hợp, ông Dương Thị Hoàn làm tri sự, ông Lã Đình Thức là lão thành, bị bắt đem đi tra khảo. Sau một thời gian hai ông được tha về rồi mất. Riêng cụ Lã Hữu Lý còn tại giam đến ngày 04/12/1789 (âm lịch). Cụ bị đánh đập và hy sinh trong nhà tù. Dân làng biết được tin này họp lại để nhớ ơn 3 cụ chịu đòn oan và đề nghị cấp trên minh xét.</p>
                <p>Cụ Lê Đình Thức và cụ Dương Thị Hoàn vì dân mà chịu đòn tan được dân làng trông coi vợ con một đời. Còn cụ Lã Hữu Lý được dân làng, cấp trên xét là người có đức, có nhân, giúp người đói khổ, chịu đòn oan lúc cần chiến sự. Cụ được phong hai chữ: <span class="highlight-text">"Hậu Thần"</span>.</p>
                <p>Hậu Thần làng sống Tết chết Giỗ.</p>
                <p class="text-center fw-bold fst-italic text-danger mt-4">"Trải qua hơn 300 năm, Tổ tiên dòng họ Lã Hữu trồng đức trồng nhân, đời này qua đời khác uống nước nhớ nguồn!"</p>
            </div>
            <div class="modal-footer bg-light">
                <small class="text-muted fw-bold fst-italic">Người lập phả đồ: Ông Lã Ngọc Anh (Lã Hữu Bang) F11 - Tháng 10/2017</small>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="spouseModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title"><i class="fas fa-user-friends me-2"></i>Thêm Vợ/Chồng</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label fw-bold">Họ tên:</label>
                    <input type="text" id="spouseName" class="form-control" placeholder="Nhập họ tên...">
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold">Ngày sinh:</label>
                    <div class="input-group">
                        <input type="text" id="spouseDob" class="form-control" placeholder="dd/MM/yyyy (hoặc nhập năm)">
                        <input type="date" id="spouseDobPicker" class="form-control" style="max-width: 50px;" onchange="updateDateInput('spouseDob', 'spouseDobPicker')" title="Chọn từ lịch">
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold">Vai trò:</label>
                    <select id="spouseRole" class="form-select">
                        <option value="vo">Vợ</option>
                        <option value="chong">Chồng</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" onclick="confirmAddSpouse()">Lưu lại</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="childModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title"><i class="fas fa-baby me-2"></i>Thêm Con</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label fw-bold">Họ tên con:</label>
                    <input type="text" id="childName" class="form-control" placeholder="Nhập họ tên con...">
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold">Ngày sinh:</label>
                    <div class="input-group">
                        <input type="text" id="childDob" class="form-control" placeholder="dd/MM/yyyy (hoặc nhập năm)">
                        <input type="date" id="childDobPicker" class="form-control" style="max-width: 50px;" onchange="updateDateInput('childDob', 'childDobPicker')" title="Chọn từ lịch">
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold">Giới tính:</label>
                    <select id="childGender" class="form-select">
                        <option value="Nam">Nam</option>
                        <option value="Nữ">Nữ</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold">Ghi chú (nếu có):</label>
                    <input type="text" id="childNote" class="form-control" placeholder="Ví dụ: mất sớm, định cư nước ngoài...">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-success" onclick="confirmAddChild()">Lưu lại</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title"><i class="fas fa-edit me-2"></i>Sửa Thông Tin</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info py-2 small">
                    <i class="fas fa-info-circle me-1"></i> Chỉ được phép sửa Giới tính và Ngày sinh.
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold">Họ tên (Không sửa):</label>
                    <input type="text" id="editName" class="form-control bg-light" readonly>
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold">Ngày sinh:</label>
                    <div class="input-group">
                        <input type="text" id="editDob" class="form-control" placeholder="dd/MM/yyyy (hoặc nhập năm)">
                        <input type="date" id="editDobPicker" class="form-control" style="max-width: 50px;" onchange="updateDateInput('editDob', 'editDobPicker')" title="Chọn từ lịch">
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold">Giới tính:</label>
                    <select id="editGender" class="form-select">
                        <option value="Nam">Nam</option>
                        <option value="Nữ">Nữ</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-warning fw-bold" onclick="confirmEditMember()">Cập nhật</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="data.js"></script>
<script src="script.js"></script>
</body>
</html>